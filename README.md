# OpenGLPlayer - åŸºäº FFmpeg å’Œ OpenGL çš„è§†é¢‘æ’­æ”¾å™¨

è¿™æ˜¯ä¸€ä¸ªä½¿ç”¨ C++17 ç¼–å†™çš„è·¨å¹³å°è§†é¢‘æ’­æ”¾å™¨é¡¹ç›®ã€‚å®ƒåˆ©ç”¨ FFmpeg åº“è¿›è¡ŒéŸ³è§†é¢‘çš„è§£å°è£…å’Œè§£ç ï¼Œä½¿ç”¨ SDL2 è¿›è¡Œçª—å£åˆ›å»ºã€äº‹ä»¶å¤„ç†å’ŒéŸ³é¢‘è¾“å‡ºï¼Œå¹¶å€ŸåŠ© OpenGL å®ç°é«˜æ•ˆçš„ç¡¬ä»¶åŠ é€Ÿè§†é¢‘æ¸²æŸ“ã€‚

## åŠŸèƒ½ç‰¹æ€§

- **å¤šçº¿ç¨‹æ¶æ„**: é‡‡ç”¨ç‹¬ç«‹çš„è§£å°è£…çº¿ç¨‹ã€è§†é¢‘è§£ç çº¿ç¨‹å’ŒéŸ³é¢‘è§£ç çº¿ç¨‹ï¼Œç¡®ä¿äº†æ•°æ®å¤„ç†çš„å¹¶è¡Œæ€§ï¼Œæœ‰æ•ˆé¿å…äº†IOé˜»å¡å’Œè§£ç è€—æ—¶æ“ä½œå½±å“UIå“åº”ï¼Œæå‡äº†æ’­æ”¾çš„æµç•…åº¦ã€‚
- **ç²¾ç¡®çš„éŸ³è§†é¢‘åŒæ­¥**: ä»¥éŸ³é¢‘æ’­æ”¾æ—¶é—´ä½œä¸ºä¸»æ—¶é’Ÿï¼Œè§†é¢‘å¸§çš„æ˜¾ç¤ºæ—¶é—´æˆ³ä¼šä¸éŸ³é¢‘æ—¶é’Ÿè¿›è¡Œæ¯”å¯¹ï¼ŒåŠ¨æ€è°ƒæ•´æ¸²æŸ“å»¶è¿Ÿï¼Œå®ç°äº†ç²¾å‡†çš„éŸ³è§†é¢‘åŒæ­¥ã€‚
- **åŠ¨æ€è¿½å¸§/ä¸¢å¸§ç­–ç•¥**: å½“è§†é¢‘æ’­æ”¾æ˜¾è‘—è½åäºéŸ³é¢‘æ—¶ï¼Œæ’­æ”¾å™¨ä¼šè‡ªåŠ¨ä¸¢å¼ƒéƒ¨åˆ†è§†é¢‘å¸§ï¼Œå¿«é€Ÿè¿½èµ¶ä¸ŠéŸ³é¢‘è¿›åº¦ï¼Œä¿è¯ç”¨æˆ·çš„è§‚çœ‹ä½“éªŒã€‚
- **é«˜æ•ˆçš„ GPU æ¸²æŸ“**: è§†é¢‘å¸§çš„ YUV æ•°æ®è¢«ä¸Šä¼ åˆ° GPUï¼Œé€šè¿‡è‡ªå®šä¹‰çš„ GLSL ç€è‰²å™¨ï¼ˆShaderï¼‰åœ¨ GPU ç«¯å®Œæˆåˆ° RGB çš„è‰²å½©ç©ºé—´è½¬æ¢å’Œæ¸²æŸ“ï¼Œå……åˆ†åˆ©ç”¨ç¡¬ä»¶åŠ é€Ÿï¼Œæ˜¾è‘—é™ä½ CPU å ç”¨ã€‚
- **è·¨å¹³å°è®¾è®¡**: ä»£ç ä¸­åŒ…å«äº†å¯¹ macOS å’Œ Linux å¹³å°çš„æ¡ä»¶ç¼–è¯‘ï¼Œèƒ½å¤Ÿè½»æ¾é€‚é…ä¸åŒæ“ä½œç³»ç»Ÿã€‚

## ç¯å¢ƒä¾èµ–

åœ¨ç¼–è¯‘å’Œè¿è¡Œæœ¬é¡¹ç›®ä¹‹å‰ï¼Œè¯·ç¡®ä¿æ‚¨çš„ç³»ç»Ÿå·²ç»å®‰è£…äº†ä»¥ä¸‹ä¾èµ–åº“ï¼š

- **CMake** (>= 3.10)
- **C++17 ç¼–è¯‘å™¨** (ä¾‹å¦‚ GCC, Clang)
- **PkgConfig**
- **FFmpeg** (libavformat, libavcodec, libavutil, libswscale, libswresample)
- **SDL2**
- **OpenGL**
- **GLEW** (ä»…Linux)

#### åœ¨ Debian/Ubuntu ä¸Šçš„å®‰è£…å‘½ä»¤:

```bash
sudo apt update
sudo apt install build-essential cmake pkg-config
sudo apt install libavformat-dev libavcodec-dev libavutil-dev libswscale-dev libswresample-dev
sudo apt install libsdl2-dev libglew-dev libopengl-dev
```

#### åœ¨ macOS ä¸Šçš„å®‰è£…å‘½ä»¤ (ä½¿ç”¨ Homebrew):

```bash
brew install cmake pkg-config ffmpeg sdl2
```
*macOS ä¸éœ€è¦é¢å¤–å®‰è£… GLEW å’Œ OpenGLï¼Œç³»ç»Ÿæ¡†æ¶å·²æä¾›æ”¯æŒã€‚*

## ç¼–è¯‘ä¸è¿è¡Œ

1.  **åˆ›å»ºæ„å»ºç›®å½•**
    è¿›å…¥é¡¹ç›®æ ¹ç›®å½•ï¼Œåˆ›å»ºä¸€ä¸ª `build` æ–‡ä»¶å¤¹ç”¨äºå­˜æ”¾ç¼–è¯‘äº§ç‰©ã€‚
    ```bash
    mkdir build
    cd build
    ```

2.  **è¿è¡Œ CMake ç”Ÿæˆæ„å»ºç³»ç»Ÿ**
    ```bash
    cmake ..
    ```

3.  **ç¼–è¯‘é¡¹ç›®**
    ```bash
    make
    ```

4.  **è¿è¡Œæ’­æ”¾å™¨**
    ç¼–è¯‘æˆåŠŸåï¼Œ`build` ç›®å½•ä¸‹ä¼šç”Ÿæˆåä¸º `video_player` çš„å¯æ‰§è¡Œæ–‡ä»¶ã€‚é€šè¿‡å‘½ä»¤è¡Œå‚æ•°æŒ‡å®šè¦æ’­æ”¾çš„è§†é¢‘æ–‡ä»¶è·¯å¾„æ¥è¿è¡Œå®ƒã€‚
    ```bash
    ./video_player /path/to/your/video.mp4
    ```

## ğŸ“‚ é¡¹ç›®ç»“æ„

```
video_player/
â”œâ”€â”€ CMakeLists.txt         # é¡¹ç›®æ„å»ºè„šæœ¬
â”œâ”€â”€ main.cpp               # ç¨‹åºä¸»å…¥å£ï¼Œè´Ÿè´£å¯åŠ¨æ’­æ”¾å™¨
â”œâ”€â”€ VideoPlayer.h          # æ’­æ”¾å™¨æ ¸å¿ƒç±»å¤´æ–‡ä»¶
â”œâ”€â”€ VideoPlayer.cpp        # æ’­æ”¾å™¨æ ¸å¿ƒç±»å®ç°ï¼ŒåŒ…å«æ‰€æœ‰é€»è¾‘
â””â”€â”€ queue.h                # çº¿ç¨‹å®‰å…¨çš„å¸§é˜Ÿåˆ—å’ŒåŒ…é˜Ÿåˆ—å®ç°
```

- **`CMakeLists.txt`**: å®šä¹‰äº†é¡¹ç›®çš„ä¾èµ–é¡¹ã€æºæ–‡ä»¶ã€å¤´æ–‡ä»¶è·¯å¾„å’Œé“¾æ¥åº“ï¼Œæ˜¯é¡¹ç›®æ„å»ºçš„æ ¸å¿ƒã€‚
- **`main.cpp`**: ç®€å•çš„ç¨‹åºå…¥å£ï¼Œè§£æå‘½ä»¤è¡Œä¼ å…¥çš„è§†é¢‘æ–‡ä»¶è·¯å¾„ï¼Œå¹¶å®ä¾‹åŒ– `VideoPlayer` ç±»æ¥å¯åŠ¨æ’­æ”¾æµç¨‹ã€‚
- **`VideoPlayer.h/.cpp`**: é¡¹ç›®çš„æ ¸å¿ƒã€‚è¿™ä¸ªç±»å°è£…äº†æ‰€æœ‰ä¸ FFmpegã€SDL å’Œ OpenGL ç›¸å…³çš„å¤æ‚æ“ä½œï¼ŒåŒ…æ‹¬ï¼š
    - æ‰“å¼€å’Œè§£æè§†é¢‘æ–‡ä»¶ã€‚
    - åˆå§‹åŒ–è§£ç å™¨å’Œç¡¬ä»¶ç¯å¢ƒã€‚
    - åˆ›å»ºå’Œç®¡ç†ä¸‰ä¸ªæ ¸å¿ƒçº¿ç¨‹ï¼ˆè§£å°è£…ã€éŸ³/è§†é¢‘è§£ç ï¼‰ã€‚
    - å®ç°éŸ³è§†é¢‘åŒæ­¥é€»è¾‘ã€‚
    - ç®¡ç† OpenGL èµ„æºï¼ˆçº¹ç†ã€ç€è‰²å™¨ï¼‰å¹¶æ¸²æŸ“è§†é¢‘å¸§ã€‚
    - å¤„ç†éŸ³é¢‘é‡é‡‡æ ·å’Œå›è°ƒã€‚
- **`queue.h`**: æä¾›äº†ä¸¤ä¸ªçº¿ç¨‹å®‰å…¨çš„é˜Ÿåˆ—ï¼š`PacketQueue` ç”¨äºå­˜å‚¨è§£å°è£…åçš„éŸ³è§†é¢‘åŒ…ï¼ˆAVPacketï¼‰ï¼Œ`FrameQueue` ç”¨äºå­˜å‚¨è§£ç åçš„éŸ³è§†é¢‘å¸§ï¼ˆAVFrameï¼‰ã€‚å®ƒä»¬æ˜¯å®ç°å¤šçº¿ç¨‹ç”Ÿäº§è€…-æ¶ˆè´¹è€…æ¨¡å‹çš„å…³é”®ã€‚


