# FluentPlayer (æµç•…æ’­æ”¾å™¨)

ä¸€ä¸ªä½¿ç”¨ C++, FFmpeg å’Œ SDL2 æ„å»ºçš„ç®€å•è§†é¢‘æ’­æ”¾å™¨ã€‚è¯¥é¡¹ç›®æ—¨åœ¨æ¼”ç¤ºä¸€ä¸ªå¤šçº¿ç¨‹ã€æ”¯æŒéŸ³è§†é¢‘åŒæ­¥çš„åª’ä½“æ’­æ”¾å™¨æ ¸å¿ƒé€»è¾‘ã€‚

---
## ğŸ”® æœªæ¥è®¡åˆ’

ä¸‹ä¸€æ­¥çš„æ”¹è¿›æ–¹å‘æ˜¯å¼•å…¥ OpenGL è¿›è¡Œè§†é¢‘æ¸²æŸ“ï¼Œä»¥æ›¿ä»£å½“å‰åŸºäº CPU çš„ `SDL_Renderer` æ–¹æ¡ˆã€‚

- **ä½¿ç”¨ OpenGL ä¼˜åŒ–æ¸²æŸ“**:
    - å°† YUV åˆ° RGB çš„è‰²å½©ç©ºé—´è½¬æ¢å·¥ä½œäº¤ç”± GPU ç‰‡æ®µç€è‰²å™¨å¤„ç†ï¼Œæ˜¾è‘—é™ä½ CPU å ç”¨ã€‚
    - ä½¿ç”¨ GPU è¿›è¡Œç¡¬ä»¶åŠ é€Ÿçš„çº¹ç†ä¸Šä¼ å’Œæ¸²æŸ“ï¼Œæé«˜é«˜åˆ†è¾¨ç‡è§†é¢‘çš„æ’­æ”¾æ€§èƒ½ã€‚
- **å®ç°é«˜çº§è§†è§‰æ•ˆæœ**:
    - é€šè¿‡ç¼–å†™è‡ªå®šä¹‰ç€è‰²å™¨ï¼ˆShaderï¼‰ï¼Œå¯ä»¥è½»æ¾å®ç°å®æ—¶è§†é¢‘æ»¤é•œï¼ˆå¦‚ç°åº¦ã€æ€€æ—§ï¼‰ã€äº®åº¦/å¯¹æ¯”åº¦è°ƒèŠ‚ç­‰åŠŸèƒ½ã€‚
    - å®ç°æ›´é«˜è´¨é‡çš„è§†é¢‘ç¼©æ”¾å’Œåå¤„ç†æ•ˆæœã€‚

## âœ¨ åŠŸèƒ½ç‰¹æ€§

- **æ’­æ”¾éŸ³è§†é¢‘**: æ”¯æŒæ’­æ”¾åŒ…å«è§†é¢‘å’ŒéŸ³é¢‘æµçš„åª’ä½“æ–‡ä»¶ã€‚
- **FFmpeg é©±åŠ¨**: ä½¿ç”¨å¼ºå¤§çš„ FFmpeg åº“è¿›è¡Œè§£å¤ç”¨å’Œè§£ç ã€‚
- **SDL2 æ¸²æŸ“**: ä½¿ç”¨ SDL2 åº“è¿›è¡Œè§†é¢‘æ¸²æŸ“å’ŒéŸ³é¢‘æ’­æ”¾ã€‚
- **å¤šçº¿ç¨‹æ¶æ„**:
    - ä¸€ä¸ª**è§£å¤ç”¨çº¿ç¨‹**ï¼Œç”¨äºä»æ–‡ä»¶ä¸­è¯»å–æ•°æ®åŒ…ã€‚
    - ç‹¬ç«‹çš„**è§†é¢‘è§£ç çº¿ç¨‹**å’Œ**éŸ³é¢‘è§£ç çº¿ç¨‹**ã€‚
- **çº¿ç¨‹å®‰å…¨é˜Ÿåˆ—**: ä½¿ç”¨è‡ªå®šä¹‰çš„çº¿ç¨‹å®‰å…¨é˜Ÿåˆ—åœ¨çº¿ç¨‹ä¹‹é—´å®‰å…¨åœ°ä¼ é€’æ•°æ®åŒ…å’Œæ•°æ®å¸§ã€‚
- **éŸ³è§†é¢‘åŒæ­¥**: å®ç°åŸºæœ¬çš„éŸ³è§†é¢‘åŒæ­¥æœºåˆ¶ï¼Œä»¥éŸ³é¢‘æ—¶é’Ÿä¸ºä¸»æ—¶é’Ÿï¼Œä¿è¯æµç•…æ’­æ”¾ã€‚
- **å¯ä¼¸ç¼©çª—å£**: æ’­æ”¾å™¨çª—å£æ”¯æŒè°ƒæ•´å¤§å°ã€‚

## âš™ï¸ ä¾èµ–ç¯å¢ƒ

åœ¨ç¼–è¯‘å’Œè¿è¡Œæœ¬é¡¹ç›®ä¹‹å‰ï¼Œç¡®ä¿å·²å®‰è£…ä»¥ä¸‹ä¾èµ–ï¼š

- `CMake` (ç‰ˆæœ¬ >= 3.10)
- æ”¯æŒ C++17 çš„ç¼–è¯‘å™¨ (å¦‚ g++, Clang)
- `pkg-config`
- FFmpeg å¼€å‘åº“ (`libavformat`, `libavcodec`, `libavutil`, `libswscale`, `libswresample`)
- SDL2 å¼€å‘åº“

#### åœ¨ Debian/Ubuntu ä¸Šçš„å®‰è£…å‘½ä»¤

```bash
sudo apt-get update
sudo apt-get install build-essential cmake pkg-config libavformat-dev libavcodec-dev libavutil-dev libswscale-dev libswresample-dev libsdl2-dev
```

## ğŸš€ å¦‚ä½•ç¼–è¯‘

1.  **å…‹éš†æˆ–ä¸‹è½½é¡¹ç›®**
    é¡¹ç›®ä¸‹è½½åˆ° `video_palyer` ç›®å½•ã€‚

    ```bash
    cd video_palyer
    ```

2.  **åˆ›å»ºå¹¶è¿›å…¥ build ç›®å½•**

    ```bash
    mkdir build
    cd build
    ```

3.  **è¿è¡Œ CMake ç”Ÿæˆæ„å»ºæ–‡ä»¶**

    ```bash
    cmake ..
    ```

4.  **ç¼–è¯‘é¡¹ç›®**

    ```bash
    make
    ```

ç¼–è¯‘æˆåŠŸåï¼Œå°†åœ¨ `build` ç›®å½•ä¸‹ç”Ÿæˆåä¸º `Video_player` çš„å¯æ‰§è¡Œæ–‡ä»¶ã€‚

## â–¶ï¸ å¦‚ä½•è¿è¡Œ

åœ¨é¡¹ç›®æ ¹ç›®å½•ä¸‹æ‰§è¡Œä»¥ä¸‹å‘½ä»¤æ¥æ’­æ”¾è§†é¢‘æ–‡ä»¶ï¼š

```bash
./build/Video_player /path/to/your/video.mp4
```

è¯·å°† `/path/to/your/video.mp4` æ›¿æ¢ä¸ºå®é™…çš„è§†é¢‘æ–‡ä»¶è·¯å¾„ã€‚

## ğŸ“‚ é¡¹ç›®ç»“æ„

```
video_palyer/
â”œâ”€â”€ CMakeLists.txt         # CMake æ„å»ºé…ç½®æ–‡ä»¶
â”œâ”€â”€ src/                   # æºä»£ç ç›®å½•
â”‚   â”œâ”€â”€ main.cpp           # ç¨‹åºä¸»å…¥å£
â”‚   â”œâ”€â”€ videoplayer.h      # VideoPlayer ç±»çš„å¤´æ–‡ä»¶
â”‚   â”œâ”€â”€ videoplayer.cpp    # VideoPlayer ç±»çš„å®ç°
â”‚   â””â”€â”€ threadsafe_queue.h # çº¿ç¨‹å®‰å…¨é˜Ÿåˆ—çš„å®ç°
â””â”€â”€ build/                 # ç¼–è¯‘è¾“å‡ºç›®å½•
```

## ğŸ“˜ ä»£ç æ¶æ„æ¦‚è§ˆ

æœ¬æ’­æ”¾å™¨é‡‡ç”¨å¤šçº¿ç¨‹çš„ç”Ÿäº§è€…-æ¶ˆè´¹è€…æ¨¡å‹ï¼š

1.  **è§£å¤ç”¨çº¿ç¨‹ (`demux_thread_entry`)**:
    - **èŒè´£**: ä½œä¸ºç”Ÿäº§è€…ï¼Œä»åª’ä½“æ–‡ä»¶ä¸­è¯»å– `AVPacket`ã€‚
    - **æµç¨‹**: è°ƒç”¨ `av_read_frame`ï¼Œå°†è¯»å–åˆ°çš„è§†é¢‘å’ŒéŸ³é¢‘åŒ…åˆ†åˆ«æ¨å…¥å¯¹åº”çš„ `PacketQueue`ã€‚

2.  **è§£ç çº¿ç¨‹ (`video_decode_thread_entry`, `audio_decode_thread_entry`)**:
    - **èŒè´£**: ä½œä¸ºæ¶ˆè´¹è€…ï¼ˆå¯¹äº PacketQueueï¼‰å’Œç”Ÿäº§è€…ï¼ˆå¯¹äº FrameQueueï¼‰ã€‚
    - **æµç¨‹**: ä» `PacketQueue` ä¸­å–å‡º `AVPacket`ï¼Œè§£ç æˆ `AVFrame`ï¼Œç„¶åå°†è§£ç åçš„ `AVFrame` æ¨å…¥å¯¹åº”çš„ `FrameQueue`ã€‚

3.  **ä¸»çº¿ç¨‹ (`main_loop`)**:
    - **èŒè´£**: ç®¡ç† SDL çª—å£ã€å¤„ç†ç”¨æˆ·äº‹ä»¶å’Œæ¸²æŸ“è§†é¢‘ã€‚
    - **æµç¨‹**: ä» `video_frame_q` ä¸­å–å‡ºè§†é¢‘å¸§ï¼Œæ ¹æ®éŸ³é¢‘æ—¶é’Ÿè®¡ç®—æ­£ç¡®çš„æ˜¾ç¤ºæ—¶é—´ï¼Œæ‰§è¡Œå»¶è¿Ÿåï¼Œå°†è§†é¢‘å¸§æ¸²æŸ“åˆ°å±å¹•ä¸Šã€‚

4.  **éŸ³é¢‘å›è°ƒ (`audio_callback`)**:
    - **èŒè´£**: å‘éŸ³é¢‘è®¾å¤‡æä¾›PCMæ•°æ®ã€‚
    - **æµç¨‹**: æ­¤å‡½æ•°ç”± SDL éŸ³é¢‘å­ç³»ç»Ÿåœ¨éœ€è¦æ•°æ®æ—¶è‡ªåŠ¨è°ƒç”¨ã€‚å®ƒä» `audio_frame_q` ä¸­å–å‡ºéŸ³é¢‘å¸§ï¼Œè¿›è¡Œé‡é‡‡æ ·ï¼Œç„¶åå°†æ•°æ®æ‹·è´åˆ° SDL æä¾›çš„ç¼“å†²åŒºã€‚æ­¤å›è°ƒçš„æ‰§è¡Œé¢‘ç‡é©±åŠ¨ç€æ•´ä¸ªæ’­æ”¾å™¨çš„**ä¸»æ—¶é’Ÿï¼ˆéŸ³é¢‘æ—¶é’Ÿï¼‰**ã€‚
